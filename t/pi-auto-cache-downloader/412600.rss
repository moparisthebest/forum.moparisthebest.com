<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>[PI] Auto Cache Downloader</title>
    <link>https://forum.moparisthebest.com/t/pi-auto-cache-downloader/412600</link>
    <description>I need help adding my auto cache downloader. It won&#39;t unpack the cache. Willing to pay rsgp.</description>
    
    <lastBuildDate>Tue, 30 Aug 2011 17:17:44 +0000</lastBuildDate>
    <category>Game Development</category>
    <atom:link href="https://forum.moparisthebest.com/t/pi-auto-cache-downloader/412600.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>[PI] Auto Cache Downloader</title>
        <dc:creator><![CDATA[@Nonamee Nonamee]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/nonamee">@Nonamee</a> wrote:</p>
          <blockquote>
              <p>Error I get in client’s command prompt:</p>
<p><code>VirtualEnergyCache.zip  71523580
java.io.FileNotFoundException: C:\VirtualEnergyCache\Data\Animation\flo.dat (The
 system cannot find the path specified)
        at java.io.FileOutputStream.open(Native Method)
        at java.io.FileOutputStream.&lt;init&gt;(Unknown Source)
        at java.io.FileOutputStream.&lt;init&gt;(Unknown Source)
        at CacheDownloader.unzip(CacheDownloader.java:220)
        at CacheDownloader.unZip(CacheDownloader.java:177)
        at CacheDownloader.downloadCache(CacheDownloader.java:79)
        at client.startUp(client.java:8460)
        at RSApplet.run(RSApplet.java:33)
        at client.run(client.java:5752)
        at java.lang.Thread.run(Unknown Source)
java.io.FileNotFoundException: C:\VirtualEnergyCache\Maps\mapConfig.txt (The sys
tem cannot find the path specified)
        at java.io.FileInputStream.open(Native Method)
        at java.io.FileInputStream.&lt;init&gt;(Unknown Source)
        at java.io.FileInputStream.&lt;init&gt;(Unknown Source)
        at java.io.FileReader.&lt;init&gt;(Unknown Source)
        at client.setNewMaps(client.java:76)
        at client.startUp(client.java:8461)
        at RSApplet.run(RSApplet.java:33)
        at client.run(client.java:5752)
        at java.lang.Thread.run(Unknown Source)
java.io.FileNotFoundException: C:\VirtualEnergyCache\Data\Animation\flo.dat (The
 system cannot find the path specified)
        at java.io.FileOutputStream.open(Native Method)
        at java.io.FileOutputStream.&lt;init&gt;(Unknown Source)
        at java.io.FileOutputStream.&lt;init&gt;(Unknown Source)
        at Update.unZipFile(Update.java:66)
        at Update.&lt;init&gt;(Update.java:29)
        at client.streamLoaderForName(client.java:4467)
        at client.startUp(client.java:8471)
        at RSApplet.run(RSApplet.java:33)
        at client.run(client.java:5752)
        at java.lang.Thread.run(Unknown Source)</code></p>
<p>Cachedownloader.java</p>
<p>[code=java]import java.io.File;<br>
import java.io.IOException;<br>
import java.io.OutputStream;<br>
import java.io.FileWriter;<br>
import java.io.BufferedWriter;<br>
import java.io.BufferedOutputStream;<br>
import java.io.BufferedInputStream;<br>
import java.io.FileOutputStream;<br>
import java.io.FileInputStream;<br>
import java.io.InputStream;<br>
import java.net.URLConnection;<br>
import java.net.URL;<br>
import java.util.zip.ZipFile;<br>
import java.util.zip.ZipEntry;<br>
import java.util.zip.ZipInputStream;<br>
import java.util.Enumeration;</p>
<p>import sign.signlink;</p>
<p>public class CacheDownloader {</p>
<pre><code>private client client;

private final int BUFFER = 1024;

private final int VERSION = 3; // Version of cache
//private String cacheLink = "http://dl.dropbox.com/u/33435992/VirtualEnergyCache.zip"; // Link to cache
private String cacheLink = "http://dl.dropbox.com/u/33435992/VirtualEnergyCache.zip"; // Link to cache

private String fileToExtract = getCacheDir() + getArchivedName();

public CacheDownloader(client client) {
	this.client = client;
}

private void drawLoadingText(String text) {
	client.drawLoadingText(35, text);
	//System.out.println(text);
}


private void drawLoadingText(int amount, String text) {
	client.drawLoadingText(amount, text);
	//System.out.println(text);
}

private String getCacheDir() {
	return signlink.findcachedir();
}

private String getCacheLink() {
	return cacheLink;
}

private int getCacheVersion() {
	return VERSION;
}

public CacheDownloader downloadCache() {
	try {
	File location = new File(getCacheDir());
	File version = new File(getCacheDir() + "/cacheVersion" + getCacheVersion() + ".dat");
	
	if(!location.exists()) {
		//drawLoadingText("Loading new Updates....");
		downloadFile(getCacheLink(), getArchivedName());

		unZip();
		//System.out.println("UNZIP");

		BufferedWriter versionFile = new BufferedWriter(new FileWriter(getCacheDir() + "/cacheVersion" + getCacheVersion() + ".dat"));
		versionFile.close();
		deleteZIP(getArchivedName());
	} else {
		if(!version.exists()) {
			//drawLoadingText("~ First Time Installation, Only Once! ~");
			downloadFile(getCacheLink(), getArchivedName());

			unZip();
			//System.out.println("UNZIP");

			BufferedWriter versionFile = new BufferedWriter(new FileWriter(getCacheDir() + "/cacheVersion" + getCacheVersion() + ".dat"));
			versionFile.close();
			deleteZIP(getArchivedName());

		} else {
			return null;
		}
	}
	} catch(Exception e) {

	}
	return null;
}

private void downloadFile(String adress, String localFileName) {
	OutputStream out = null;
	URLConnection conn;
	InputStream in = null;
	
	try {

		URL url = new URL(adress);
		out = new BufferedOutputStream(
			new FileOutputStream(getCacheDir() + "/" +localFileName)); 

		conn = url.openConnection();
		in = conn.getInputStream(); 
	
		byte[] data = new byte[BUFFER]; 

		int numRead;
		long numWritten = 0;
		int length = conn.getContentLength();


		while((numRead = in.read(data)) != -1) {
			out.write(data, 0, numRead);
			numWritten += numRead;

        			int percentage = (int)(((double)numWritten / (double)length) * 100D);
			drawLoadingText(percentage, "Downloading Cache " + percentage + "%...");

		}

		System.out.println(localFileName + "\t" + numWritten);
		drawLoadingText("Unpacking..");

	} catch (Exception exception) {
		exception.printStackTrace();
	} finally {
		try {
			if (in != null) {
				in.close();
			}
			if (out != null) {
				out.close();
			}
		} catch (IOException ioe) {
		}
	}

}

private String getArchivedName() {
	int lastSlashIndex = getCacheLink().lastIndexOf('/');
	if (lastSlashIndex &gt;= 0 
		&amp;&amp; lastSlashIndex &lt; getCacheLink().length() -1) { 
		return getCacheLink().substring(lastSlashIndex + 1);
	} else {
		//System.err.println("error retreiving archivaed name.");
	}
	return "";
}




private void unZip() {

	try {
			InputStream in = 
			new BufferedInputStream(new FileInputStream(fileToExtract));
		ZipInputStream zin = new ZipInputStream(in);
		ZipEntry e;

		while((e=zin.getNextEntry()) != null) {

           			if(e.isDirectory()) {
				(new File(getCacheDir() + e.getName())).mkdir();
           			} else {

			if (e.getName().equals(fileToExtract)) {
				unzip(zin, fileToExtract);
				break;
			}
   					unzip(zin, getCacheDir() + e.getName());
			}
			//System.out.println("unzipping2 " + e.getName());
		}
		zin.close();

	} catch(Exception e) {
		e.printStackTrace();
	}
}
</code></pre>
<p>private void deleteZIP(String fileName){<br>
// A File object to represent the filename<br>
File f = new File(getCacheDir() + fileName);</p>
<pre><code>// Make sure the file or directory exists and isn't write protected
if (!f.exists())
  throw new IllegalArgumentException(
      "Delete: no such file or directory: " + fileName);

if (!f.canWrite())
  throw new IllegalArgumentException("Delete: write protected: "
      + fileName);

// If it is a directory, make sure it is empty
if (f.isDirectory()) {
  String[] files = f.list();
  if (files.length &gt; 0)
    throw new IllegalArgumentException(
        "Delete: directory not empty: " + fileName);
}

// Attempt to delete it
boolean success = f.delete();

if (!success)
  throw new IllegalArgumentException("Delete: deletion failed");

}

private void unzip(ZipInputStream zin, String s) 
	throws IOException {

	FileOutputStream out = new FileOutputStream(s);
	//System.out.println("unzipping " + s);
	byte [] b = new byte[BUFFER];
	int len = 0;

	while ((len = zin.read(b)) != -1) {
		out.write(b,0,len);
	}
	out.close();
}
</code></pre>
<p>}[/code]</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/pi-auto-cache-downloader/412600/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/pi-auto-cache-downloader/412600/4</link>
        <pubDate>Tue, 30 Aug 2011 17:17:44 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-412600-4</guid>
        <source url="https://forum.moparisthebest.com/t/pi-auto-cache-downloader/412600.rss">[PI] Auto Cache Downloader</source>
      </item>
      <item>
        <title>[PI] Auto Cache Downloader</title>
        <dc:creator><![CDATA[@Coelho Coelho]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/coelho">@Coelho</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="2" data-topic="412600">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/ljoxaa/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> ljoxaa:</div>
<blockquote>
<p>ill explain to you how i did, go to <a href="http://www.dropblox.com" rel="nofollow noopener">www.dropblox.com</a> upload ur cache.zip there in public folder then click on it and get the link to it, then go to ur client folder and find client.java and cachedownloader.java and  change the download links there. and thats it, and when u do .zip ur cache u must zip all file that are inside ur cache folder!  <img src="https://forum.moparisthebest.com/images/emoji/twitter/wink.png?v=5" title=":wink:" class="emoji" alt=":wink:"></p>
</blockquote>
</aside>
<p>You did not answer his question in any way whatsoever.</p>
<p><span class="mention">@op</span> Post your code?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/pi-auto-cache-downloader/412600/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/pi-auto-cache-downloader/412600/3</link>
        <pubDate>Tue, 30 Aug 2011 03:34:33 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-412600-3</guid>
        <source url="https://forum.moparisthebest.com/t/pi-auto-cache-downloader/412600.rss">[PI] Auto Cache Downloader</source>
      </item>
      <item>
        <title>[PI] Auto Cache Downloader</title>
        <dc:creator><![CDATA[@ljoxaa ljoxaa]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/ljoxaa">@ljoxaa</a> wrote:</p>
          <blockquote>
              <p>ill explain to you how i did, go to <a href="http://www.dropblox.com" rel="nofollow noopener">www.dropblox.com</a> upload ur cache.zip there in public folder then click on it and get the link to it, then go to ur client folder and find client.java and cachedownloader.java and  change the download links there. and thats it, and when u do .zip ur cache u must zip all file that are inside ur cache folder!  <img src="https://forum.moparisthebest.com/images/emoji/twitter/wink.png?v=5" title=":wink:" class="emoji" alt=":wink:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/pi-auto-cache-downloader/412600/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/pi-auto-cache-downloader/412600/2</link>
        <pubDate>Tue, 30 Aug 2011 02:49:26 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-412600-2</guid>
        <source url="https://forum.moparisthebest.com/t/pi-auto-cache-downloader/412600.rss">[PI] Auto Cache Downloader</source>
      </item>
      <item>
        <title>[PI] Auto Cache Downloader</title>
        <dc:creator><![CDATA[@Nonamee Nonamee]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/nonamee">@Nonamee</a> wrote:</p>
          <blockquote>
              <p>I need help adding my auto cache downloader. It won’t unpack the cache. Willing to pay rsgp.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/pi-auto-cache-downloader/412600/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/pi-auto-cache-downloader/412600/1</link>
        <pubDate>Mon, 29 Aug 2011 11:16:17 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-412600-1</guid>
        <source url="https://forum.moparisthebest.com/t/pi-auto-cache-downloader/412600.rss">[PI] Auto Cache Downloader</source>
      </item>
  </channel>
</rss>
